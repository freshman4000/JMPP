<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:http="http://www.w3.org/1999/xhtml">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <title>Admin panel</title>
    <style>
    </style>
</head>
<body>


<nav class="navbar navbar-expand-sm navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand text-white-50" href="/hello">  Project name</a>
        <ul class="navbar-nav">
            <li class="nav-tem">
                <a href="/logout" class="nav-link text-white-50">Logout</a>
            </li >
        </ul>
    </div>
    </div>
</nav>
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-2">
            <div class="row d.block bg-info mt-3">
                <a class="text-white py-2 pl-4" href="/admin/admin_panel">Admin</a></div>
            <div class="row d.block bg-white"><a class="text-info py-2 pl-4" href="/hello">User</a></div>
        </div>
        <div class="col-sm-10 mt-3 bg-light">
            <h1 class="font-weight-bold pl-4">Admin panel</h1>
            <nav>
                <ul class="nav nav-tabs">
                    <li class="nav-item">
                        <a class="nav-link active text-secondary" href="/admin/admin_panel">
                            <small>Users table</small></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-info" href="/admin/add_user_form"><small>New user</small></a>
                    </li>
                </ul>
            </nav>
            <div class="border rounded-top py-2">
                <span class="font-weight-bold pl-4">All users</span>
            </div>
            <div class="container-fluid border bg-white" id="wind">

                <table class="table table-block bg-white table-hover table-striped mx-auto">
                    <thead>
                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">Role</th>
                        <th scope="col">First name</th>
                        <th scope="col">Last name</th>
                        <th scope="col">Email</th>
                        <th scope="col">Birth date</th>
                        <th scope="col">Phone</th>
                        <th scope="col">Edit</th>
                        <th scope="col">Delete</th>
                    </tr>
                    </thead>
                    <tbody  id="div3">
                    <tr>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>
    function deleteUser(id) {
        $.ajax({url: 'http://localhost:8080/api/admin/delete/' + id, method: 'POST'});
        location.reload();
    }
</script>
<script>
    function adminPanel() {
        $.ajax({
            url : 'http://localhost:8080/api/admin/show_all_users',
            type : 'GET',
            dataType: 'json',
            success : function(list) {
                $.each(list, function (i) {
                    $("#div3").append("<tr>" +
                        "<td>" + list[i].id + "</td>" +
                        "<td id='rl'>" + list[i].roles[0].name + "</td>" +
                        "<td>" + list[i].firstname + "</td>" +
                        "<td>" + list[i].lastname + "</td>" +
                        "<td>" + list[i].email + "</td>" +
                        "<td>" + list[i].birthdate + "</td>" +
                        "<td>" + list[i].phone + "</td>" +
                        "<td>" +
                        "<button class='btn btn-sm btn-info'>" +
                        'edit' +
                        "</button>" + "</td>" +
                        "<td>" +
                        "<button class='btn btn-sm btn-outline-danger' onclick='deleteUser(" + list[i].id + ")'>" +
                        'delete' +
                        "</button>" + "</td>" +
                        "</tr>");
                    if (list[i].roles.length > 1) {
                        $("#rl").append(', ' + list[i].roles[1].name);
                    }
                })

            }
        });

    }
</script>
<script>
    $(document).ready(adminPanel());
</script>
</body>
</html>